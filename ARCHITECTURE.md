# Mortgage Analyst Pro - æ¶æ„æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**Mortgage Analyst Pro** æ˜¯ä¸€ä¸ªå…¨æ ˆã€AIé©±åŠ¨çš„æŠµæŠ¼è´·æ¬¾åˆ†æå¹³å°ï¼Œä¸“ä¸ºæŠµæŠ¼è´·æ¬¾ä¸“ä¸šäººå£«è®¾è®¡ã€‚è¯¥åº”ç”¨è‡ªåŠ¨åŒ–æ–‡æ¡£å¤„ç†ã€è®¡ç®—åŠ æ‹¿å¤§æŠµæŠ¼è´·æ¬¾åˆè§„æŒ‡æ ‡ï¼ˆGDS/TDSæ¯”ç‡ï¼‰ã€æ‰§è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¹¶æä¾›äº¤äº’å¼å¯è§†åŒ–åˆ†æã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆæ€»è§ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Next.js 15** (App Router) - Reactå…¨æ ˆæ¡†æ¶
- **React 19** - UIåº“
- **TypeScript 5.7** - ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†

### æ ·å¼ä¸UI
- **Tailwind CSS 3.4** - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **PostCSS 8.4** - CSSåå¤„ç†å™¨
- **Autoprefixer** - CSSè‡ªåŠ¨å‰ç¼€å·¥å…·

### æ•°æ®å¯è§†åŒ–
- **Recharts 2.15** - Reactå›¾è¡¨åº“

### æ•°æ®åº“ä¸ORM
- **Prisma 6.2** - ç±»å‹å®‰å…¨çš„ORM
- **SQLite** - è½»é‡çº§æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### AIé›†æˆ
- **Anthropic Claude SDK 0.32** - Claude 3.5 Sonnet APIé›†æˆ

### å¼€å‘å·¥å…·
- **ESLint 9.18** - ä»£ç è´¨é‡æ£€æŸ¥
- **Jest 29.7** - æµ‹è¯•æ¡†æ¶
- **Testing Library** - Reactç»„ä»¶æµ‹è¯•å·¥å…·

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„è¯¦è§£

```
mortgage-analyst-pro/
â”œâ”€â”€ app/                          # Next.js App Router ç›®å½•
â”‚   â”œâ”€â”€ actions/                  # Server Actionsï¼ˆæœåŠ¡ç«¯æ“ä½œï¼‰
â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±
â”‚   â”œâ”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.tsx               # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ page.tsx                 # ä¸»é¡µé¢
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ charts/                  # å›¾è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ dashboard/               # ä»ªè¡¨æ¿ç»„ä»¶
â”‚   â””â”€â”€ forms/                   # è¡¨å•ç»„ä»¶
â”œâ”€â”€ lib/                         # å·¥å…·åº“
â”‚   â””â”€â”€ math/                    # æ•°å­¦è®¡ç®—å¼•æ“
â”œâ”€â”€ services/                    # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â””â”€â”€ ai/                      # AIæœåŠ¡
â”œâ”€â”€ types/                       # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ prisma/                      # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ schema.prisma           # Prismaæ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ dev.db                  # SQLiteæ•°æ®åº“æ–‡ä»¶
â””â”€â”€ [é…ç½®æ–‡ä»¶]                   # å„ç§é…ç½®æ–‡ä»¶
```

---

## ğŸ“„ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### ğŸ”§ é…ç½®æ–‡ä»¶

#### `package.json`
**è¯­è¨€**: JSON  
**ä½œç”¨**: 
- å®šä¹‰é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
- ç®¡ç†npmåŒ…ç‰ˆæœ¬
- é…ç½®é¡¹ç›®å…ƒæ•°æ®

**å…³é”®ä¾èµ–**:
- `next`: Next.jsæ¡†æ¶
- `react`, `react-dom`: Reactåº“
- `@prisma/client`: Prismaå®¢æˆ·ç«¯
- `@anthropic-ai/sdk`: Claude AI SDK
- `recharts`: å›¾è¡¨åº“

#### `tsconfig.json`
**è¯­è¨€**: JSON  
**ä½œç”¨**: 
- TypeScriptç¼–è¯‘å™¨é…ç½®
- è·¯å¾„åˆ«åè®¾ç½® (`@/*` â†’ `./*`)
- ç¼–è¯‘é€‰é¡¹ï¼ˆä¸¥æ ¼æ¨¡å¼ã€ES2020ç›®æ ‡ç­‰ï¼‰

**å…³é”®é…ç½®**:
```json
{
  "paths": { "@/*": ["./*"] },  // è·¯å¾„åˆ«å
  "strict": true,                // ä¸¥æ ¼ç±»å‹æ£€æŸ¥
  "target": "ES2020"            // ç¼–è¯‘ç›®æ ‡
}
```

#### `next.config.ts`
**è¯­è¨€**: TypeScript  
**ä½œç”¨**: 
- Next.jsæ¡†æ¶é…ç½®
- è‡ªå®šä¹‰æ„å»ºé€‰é¡¹
- ç¯å¢ƒå˜é‡é…ç½®

#### `tailwind.config.ts`
**è¯­è¨€**: TypeScript  
**ä½œç”¨**: 
- Tailwind CSSé…ç½®
- è‡ªå®šä¹‰ä¸»é¢˜å’Œé¢œè‰²
- å†…å®¹è·¯å¾„é…ç½®ï¼ˆæ‰«æå“ªäº›æ–‡ä»¶ï¼‰

#### `postcss.config.mjs`
**è¯­è¨€**: JavaScript (ES Module)  
**ä½œç”¨**: 
- PostCSSé…ç½®
- Tailwindå’ŒAutoprefixeræ’ä»¶é…ç½®

#### `.eslintrc.json`
**è¯­è¨€**: JSON  
**ä½œç”¨**: 
- ESLintä»£ç æ£€æŸ¥è§„åˆ™
- Next.jsæ¨èçš„ä»£ç è§„èŒƒ

---

### ğŸ“± Appç›®å½• (`app/`)

#### `app/layout.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: Next.js App Router, React Server Component  
**ä½œç”¨**: 
- æ ¹å¸ƒå±€ç»„ä»¶ï¼ˆæ‰€æœ‰é¡µé¢çš„åŒ…è£…å™¨ï¼‰
- è®¾ç½®HTMLç»“æ„ï¼ˆ`<html>`, `<body>`ï¼‰
- å¯¼å…¥å…¨å±€æ ·å¼
- è®¾ç½®é¡µé¢å…ƒæ•°æ®ï¼ˆtitle, descriptionï¼‰

**ç‰¹ç‚¹**: 
- Server Componentï¼ˆé»˜è®¤ï¼‰
- ä¸åŒ…å«å®¢æˆ·ç«¯äº¤äº’é€»è¾‘

#### `app/page.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: Next.js App Router, React Client Component  
**ä½œç”¨**: 
- ä¸»ä»ªè¡¨æ¿é¡µé¢
- æ•´åˆæ‰€æœ‰åŠŸèƒ½ç»„ä»¶
- ç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆè®¡ç®—ç»“æœã€å®¢æˆ·ç«¯ä¿¡æ¯ï¼‰
- å¤„ç†è¡¨å•æäº¤å’Œè®¡ç®—é€»è¾‘

**å…³é”®åŠŸèƒ½**:
- ä½¿ç”¨ `'use client'` æŒ‡ä»¤ï¼ˆéœ€è¦å®¢æˆ·ç«¯äº¤äº’ï¼‰
- çŠ¶æ€ç®¡ç†ï¼ˆ`useState`ï¼‰
- è°ƒç”¨æ•°å­¦è®¡ç®—åº“
- æ¸²æŸ“å›¾è¡¨å’Œç»“æœ

#### `app/globals.css`
**è¯­è¨€**: CSS  
**æŠ€æœ¯**: Tailwind CSS  
**ä½œç”¨**: 
- å…¨å±€æ ·å¼å®šä¹‰
- TailwindæŒ‡ä»¤å¯¼å…¥
- è‡ªå®šä¹‰CSSå˜é‡

---

### ğŸ”„ Server Actions (`app/actions/`)

#### `app/actions/saveCalculation.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: Next.js Server Actions, Prisma ORM  
**ä½œç”¨**: 
- æœåŠ¡ç«¯æ“ä½œï¼šä¿å­˜è®¡ç®—åˆ°æ•°æ®åº“
- åˆ›å»ºæˆ–æ›´æ–°å®¢æˆ·ç«¯è®°å½•
- åˆ›å»ºæŠµæŠ¼è´·æ¬¾è®°å½•
- å¤„ç†æ•°æ®åº“äº‹åŠ¡

**å…³é”®ç‰¹æ€§**:
- `'use server'` æŒ‡ä»¤ï¼ˆæœåŠ¡ç«¯æ‰§è¡Œï¼‰
- Prismaå®¢æˆ·ç«¯æ“ä½œ
- é”™è¯¯å¤„ç†å’Œè¿”å›ç±»å‹

**æ•°æ®æµ**:
```
å®¢æˆ·ç«¯ â†’ Server Action â†’ Prisma â†’ SQLite â†’ è¿”å›ç»“æœ
```

---

### ğŸŒ APIè·¯ç”± (`app/api/`)

#### `app/api/ai/analyze-document/route.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: Next.js API Routes, Anthropic Claude SDK  
**ä½œç”¨**: 
- RESTful APIç«¯ç‚¹ï¼š`POST /api/ai/analyze-document`
- ä½¿ç”¨Claude AIåˆ†ææ–‡æ¡£
- æå–æ”¶å…¥ã€å€ºåŠ¡ã€æŠµæŠ¼è´·æ¬¾æ¡æ¬¾
- è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†

**è¯·æ±‚/å“åº”**:
```typescript
// è¯·æ±‚
POST /api/ai/analyze-document
Body: { documentText: string }

// å“åº”
{
  success: true,
  data: {
    extractedIncome: number,
    extractedDebts: number[],
    identifiedMortgageTerms: {...},
    confidence: number
  }
}
```

**å®‰å…¨ç‰¹æ€§**:
- APIå¯†é’¥æœåŠ¡å™¨ç«¯å­˜å‚¨
- è¾“å…¥é•¿åº¦éªŒè¯ï¼ˆæœ€å¤§100,000å­—ç¬¦ï¼‰
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### `app/api/clients/route.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: Next.js API Routes, Prisma ORM  
**ä½œç”¨**: 
- RESTful APIç«¯ç‚¹ï¼š`/api/clients`
- CRUDæ“ä½œï¼ˆGET, POST, PUT, DELETEï¼‰
- å®¢æˆ·ç«¯æ•°æ®ç®¡ç†
- åŒ…å«å…³è”çš„æŠµæŠ¼è´·æ¬¾æ•°æ®

**ç«¯ç‚¹**:
- `GET /api/clients` - è·å–æ‰€æœ‰å®¢æˆ·ç«¯
- `POST /api/clients` - åˆ›å»ºæ–°å®¢æˆ·ç«¯
- `PUT /api/clients` - æ›´æ–°å®¢æˆ·ç«¯
- `DELETE /api/clients?id=xxx` - åˆ é™¤å®¢æˆ·ç«¯

#### `app/api/mortgages/route.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: Next.js API Routes, Prisma ORM  
**ä½œç”¨**: 
- RESTful APIç«¯ç‚¹ï¼š`/api/mortgages`
- æŠµæŠ¼è´·æ¬¾æ•°æ®ç®¡ç†
- CRUDæ“ä½œ

---

### ğŸ§® æ•°å­¦è®¡ç®—åº“ (`lib/math/`)

#### `lib/math/payment.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: çº¯å‡½æ•°ã€æ•°å­¦å…¬å¼  
**ä½œç”¨**: 
- æŠµæŠ¼è´·æ¬¾æ”¯ä»˜è®¡ç®—
- å‘¨æœŸæ€§åˆ©ç‡è®¡ç®—ï¼ˆåŠ æ‹¿å¤§åŠå¹´åº¦å¤åˆ©ï¼‰
- æ”¯ä»˜é¢‘ç‡è½¬æ¢
- æœ€å¤§æŠµæŠ¼è´·æ¬¾é‡‘é¢è®¡ç®—

**å…³é”®å‡½æ•°**:
- `calculatePayment()` - è®¡ç®—æœˆä¾›
- `getPeriodicRate()` - è®¡ç®—å‘¨æœŸæ€§åˆ©ç‡
- `convertToMonthlyPayment()` - è½¬æ¢ä¸ºæœˆä¾›
- `calculateTotalInterest()` - è®¡ç®—æ€»åˆ©æ¯

**æ•°å­¦å…¬å¼**:
```
åŠ æ‹¿å¤§æŠµæŠ¼è´·æ¬¾å…¬å¼ï¼š
å‘¨æœŸæ€§åˆ©ç‡ = (1 + å¹´åˆ©ç‡/2)^(2/æ¯å¹´æ”¯ä»˜æ¬¡æ•°) - 1
æœˆä¾› = æœ¬é‡‘ Ã— [r(1+r)^n] / [(1+r)^n - 1]
```

#### `lib/math/affordability.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: çº¯å‡½æ•°ã€è´¢åŠ¡è®¡ç®—  
**ä½œç”¨**: 
- GDSï¼ˆæ€»å€ºåŠ¡æœåŠ¡ï¼‰æ¯”ç‡è®¡ç®—
- TDSï¼ˆæ€»å€ºåŠ¡æœåŠ¡ï¼‰æ¯”ç‡è®¡ç®—
- å¯è´Ÿæ‹…æ€§åˆ†æ
- æœ€å¤§å¯è´Ÿæ‹…æŠµæŠ¼è´·æ¬¾é‡‘é¢

**å…³é”®å‡½æ•°**:
- `calculateGDS()` - GDSæ¯”ç‡
- `calculateTDS()` - TDSæ¯”ç‡
- `calculateAffordability()` - å®Œæ•´å¯è´Ÿæ‹…æ€§åˆ†æ
- `calculateMaxAffordableMortgage()` - æœ€å¤§å¯è´Ÿæ‹…é‡‘é¢

**åŠ æ‹¿å¤§æ ‡å‡†**:
- GDSé˜ˆå€¼: â‰¤ 32%
- TDSé˜ˆå€¼: â‰¤ 40%

#### `lib/math/stress-test.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: çº¯å‡½æ•°ã€å‹åŠ›æµ‹è¯•ç®—æ³•  
**ä½œç”¨**: 
- åŠ æ‹¿å¤§æŠµæŠ¼è´·æ¬¾å‹åŠ›æµ‹è¯•
- åˆæ ¼åˆ©ç‡è®¡ç®—ï¼ˆåˆåŒåˆ©ç‡ + 2%ï¼‰
- å‹åŠ›æµ‹è¯•ä¸‹çš„å¯è´Ÿæ‹…æ€§åˆ†æ

**å…³é”®å‡½æ•°**:
- `performStressTest()` - æ‰§è¡Œå‹åŠ›æµ‹è¯•
- `calculateQualifyingRate()` - è®¡ç®—åˆæ ¼åˆ©ç‡

**æ³•è§„è¦æ±‚**:
```
åˆæ ¼åˆ©ç‡ = max(åˆåŒåˆ©ç‡ + 2%, 5.25%)
```

#### `lib/math/sensitivity.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: çº¯å‡½æ•°ã€æ•°æ®åˆ†æ  
**ä½œç”¨**: 
- åˆ©ç‡æ•æ„Ÿæ€§åˆ†æ
- æ‘Šé”€è®¡åˆ’ç”Ÿæˆ
- å¹´åº¦æ±‡æ€»æ•°æ®
- æ‘Šé”€æœŸæ¯”è¾ƒ

**å…³é”®å‡½æ•°**:
- `generateSensitivityAnalysis()` - æ•æ„Ÿæ€§åˆ†æ
- `generateAmortizationSchedule()` - å®Œæ•´æ‘Šé”€è®¡åˆ’
- `generateYearlyAmortizationSummary()` - å¹´åº¦æ±‡æ€»
- `compareAmortizationPeriods()` - æ¯”è¾ƒä¸åŒæ‘Šé”€æœŸ

**ç²¾åº¦å¤„ç†**:
- é˜²æ­¢æµ®ç‚¹æ•°ç²¾åº¦é”™è¯¯ç´¯ç§¯
- æœ€ç»ˆæ”¯ä»˜è°ƒæ•´ç¡®ä¿ä½™é¢ä¸º0
- æ‰€æœ‰é‡‘é¢å››èˆäº”å…¥åˆ°åˆ†ï¼ˆ2ä½å°æ•°ï¼‰

#### `lib/math/index.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: æ¨¡å—å¯¼å‡º  
**ä½œç”¨**: 
- ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰æ•°å­¦å‡½æ•°
- æä¾›å•ä¸€å…¥å£ç‚¹
- ç®€åŒ–å¯¼å…¥è¯­å¥

---

### ğŸ¤– AIæœåŠ¡ (`services/ai/`)

#### `services/ai/document-analyzer.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: Anthropic Claude SDK  
**ä½œç”¨**: 
- Claude AIæ–‡æ¡£åˆ†ææœåŠ¡
- ä»éç»“æ„åŒ–æ–‡æœ¬æå–ç»“æ„åŒ–æ•°æ®
- æ”¶å…¥æå–
- å€ºåŠ¡æå–
- æŠµæŠ¼è´·æ¬¾æ¡æ¬¾è¯†åˆ«

**å…³é”®å‡½æ•°**:
- `analyzeDocument()` - å®Œæ•´æ–‡æ¡£åˆ†æ
- `extractIncome()` - æå–æ”¶å…¥
- `extractDebts()` - æå–å€ºåŠ¡
- `summarizeDocument()` - æ–‡æ¡£æ‘˜è¦

**AIæ¨¡å‹**: Claude 3.5 Sonnet (20241022)

**æç¤ºå·¥ç¨‹**:
- ç»“æ„åŒ–æç¤ºè¯
- JSONå“åº”æ ¼å¼è¦æ±‚
- ç½®ä¿¡åº¦è¯„åˆ†

---

### ğŸ¨ Reactç»„ä»¶ (`components/`)

#### `components/forms/MortgageCalculatorForm.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React Hooks, å—æ§ç»„ä»¶  
**ä½œç”¨**: 
- æŠµæŠ¼è´·æ¬¾è®¡ç®—å™¨è¡¨å•
- ç”¨æˆ·è¾“å…¥æ”¶é›†ï¼ˆæœ¬é‡‘ã€åˆ©ç‡ã€æ‘Šé”€æœŸç­‰ï¼‰
- è¡¨å•éªŒè¯
- æäº¤å¤„ç†

**çŠ¶æ€ç®¡ç†**: `useState`  
**è¡¨å•å­—æ®µ**:
- æœ¬é‡‘é‡‘é¢
- å¹´åˆ©ç‡
- æ‘Šé”€å¹´æ•°
- æ”¯ä»˜é¢‘ç‡
- å¹´æ”¶å…¥
- æœˆå€ºåŠ¡

#### `components/dashboard/AffordabilityResults.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React, Tailwind CSS  
**ä½œç”¨**: 
- æ˜¾ç¤ºå¯è´Ÿæ‹…æ€§åˆ†æç»“æœ
- GDS/TDSæ¯”ç‡å¯è§†åŒ–
- è¿›åº¦æ¡æ˜¾ç¤º
- æ”¯ä»˜è¯¦æƒ…å±•ç¤º

**æ˜¾ç¤ºå†…å®¹**:
- GDS/TDSæ¯”ç‡ï¼ˆå¸¦é¢œè‰²æŒ‡ç¤ºï¼‰
- æœˆä¾›é‡‘é¢
- æ€»ä½æˆ¿æˆæœ¬
- å¯è´Ÿæ‹…æ€§çŠ¶æ€

#### `components/dashboard/AIPanel.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React Hooks, Fetch API  
**ä½œç”¨**: 
- AIæ–‡æ¡£ä¸Šä¼ å’Œåˆ†æç•Œé¢
- æ–‡æ¡£æ–‡æœ¬è¾“å…¥
- APIè°ƒç”¨å¤„ç†
- ç»“æœæ˜¾ç¤ºå’Œè‡ªåŠ¨å¡«å……

**åŠŸèƒ½**:
- æ–‡æ¡£æ–‡æœ¬è¾“å…¥
- è°ƒç”¨ `/api/ai/analyze-document`
- æå–æ•°æ®è‡ªåŠ¨å¡«å……è¡¨å•
- åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

#### `components/dashboard/ClientSidebar.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React Hooks, Fetch API  
**ä½œç”¨**: 
- å®¢æˆ·ç«¯åˆ—è¡¨ä¾§è¾¹æ 
- å®¢æˆ·ç«¯é€‰æ‹©
- å†å²è®¡ç®—åŠ è½½
- å®¢æˆ·ç«¯ç®¡ç†

**åŠŸèƒ½**:
- è·å–å®¢æˆ·ç«¯åˆ—è¡¨ (`/api/clients`)
- æ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯
- é€‰æ‹©å®¢æˆ·ç«¯åŠ è½½å†å²æ•°æ®
- åˆ·æ–°æœºåˆ¶

#### `components/charts/SensitivityChart.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React, Recharts  
**ä½œç”¨**: 
- åˆ©ç‡æ•æ„Ÿæ€§åˆ†æå›¾è¡¨
- æŠ˜çº¿å›¾æ˜¾ç¤ºä¸åŒåˆ©ç‡ä¸‹çš„æœˆä¾›
- äº¤äº’å¼å·¥å…·æç¤º
- å“åº”å¼è®¾è®¡

**å›¾è¡¨ç±»å‹**: Line Chart (Recharts)

#### `components/charts/AmortizationChart.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React, Recharts  
**ä½œç”¨**: 
- æ‘Šé”€è®¡åˆ’å¯è§†åŒ–
- å¹´åº¦æ±‡æ€»æ•°æ®å±•ç¤º
- æœ¬é‡‘vsåˆ©æ¯å¯¹æ¯”
- é¢ç§¯å›¾å±•ç¤º

**å›¾è¡¨ç±»å‹**: Area Chart (Recharts)

#### `components/charts/AmortizationComparisonChart.tsx`
**è¯­è¨€**: TypeScript + JSX  
**æŠ€æœ¯**: React, Recharts  
**ä½œç”¨**: 
- ä¸åŒæ‘Šé”€æœŸæ¯”è¾ƒ
- æŸ±çŠ¶å›¾å¯¹æ¯”
- æ€»æˆæœ¬æ¯”è¾ƒ
- æœˆä¾›å¯¹æ¯”

**å›¾è¡¨ç±»å‹**: Bar Chart (Recharts)

---

### ğŸ—„ï¸ æ•°æ®åº“ (`prisma/`)

#### `prisma/schema.prisma`
**è¯­è¨€**: Prisma Schema  
**æŠ€æœ¯**: Prisma ORM  
**ä½œç”¨**: 
- æ•°æ®æ¨¡å‹å®šä¹‰
- æ•°æ®åº“è¡¨ç»“æ„
- å…³ç³»å®šä¹‰ï¼ˆClient â†” Mortgageï¼‰
- ç´¢å¼•é…ç½®

**æ•°æ®æ¨¡å‹**:

**Clientæ¨¡å‹**:
```prisma
model Client {
  id                String     @id @default(cuid())
  name              String
  email             String     @unique
  phone             String
  grossAnnualIncome Float
  monthlyDebts      Float
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  mortgages         Mortgage[]  // ä¸€å¯¹å¤šå…³ç³»
}
```

**Mortgageæ¨¡å‹**:
```prisma
model Mortgage {
  id                 String   @id @default(cuid())
  clientId           String
  principal          Float
  interestRate       Float
  amortizationYears  Int
  paymentFrequency   String
  mortgageType       String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  client             Client   @relation(...)  // å¤šå¯¹ä¸€å…³ç³»
}
```

**å…³ç³»**: 
- Client (1) â†” (N) Mortgage
- çº§è”åˆ é™¤ï¼šåˆ é™¤Clientæ—¶è‡ªåŠ¨åˆ é™¤ç›¸å…³Mortgage

#### `prisma/dev.db`
**è¯­è¨€**: SQLiteæ•°æ®åº“æ–‡ä»¶  
**æŠ€æœ¯**: SQLite  
**ä½œç”¨**: 
- å®é™…æ•°æ®åº“æ–‡ä»¶
- å­˜å‚¨å®¢æˆ·ç«¯å’ŒæŠµæŠ¼è´·æ¬¾æ•°æ®
- å¼€å‘ç¯å¢ƒä½¿ç”¨

---

### ğŸ“ ç±»å‹å®šä¹‰ (`types/`)

#### `types/index.ts`
**è¯­è¨€**: TypeScript  
**æŠ€æœ¯**: TypeScript Interfaces, Types  
**ä½œç”¨**: 
- å…¨å±€ç±»å‹å®šä¹‰
- æ¥å£å®šä¹‰
- ç±»å‹å¯¼å‡º
- ç¡®ä¿ç±»å‹å®‰å…¨

**å…³é”®ç±»å‹**:
- `Client` - å®¢æˆ·ç«¯æ¥å£
- `Mortgage` - æŠµæŠ¼è´·æ¬¾æ¥å£
- `AffordabilityResult` - å¯è´Ÿæ‹…æ€§ç»“æœ
- `StressTestResult` - å‹åŠ›æµ‹è¯•ç»“æœ
- `PaymentFrequency` - æ”¯ä»˜é¢‘ç‡ç±»å‹
- `DocumentAnalysis` - AIåˆ†æç»“æœ

---

## ğŸ”„ æ•°æ®æµæ¶æ„

### 1. è®¡ç®—æµç¨‹
```
ç”¨æˆ·è¾“å…¥ (è¡¨å•)
    â†“
MortgageCalculatorForm (ç»„ä»¶)
    â†“
page.tsx (çŠ¶æ€ç®¡ç†)
    â†“
lib/math/* (è®¡ç®—å‡½æ•°)
    â†“
ç»“æœæ›´æ–°çŠ¶æ€
    â†“
AffordabilityResults + Charts (æ˜¾ç¤º)
```

### 2. æ•°æ®ä¿å­˜æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»ä¿å­˜
    â†“
page.tsx (è°ƒç”¨Server Action)
    â†“
app/actions/saveCalculation.ts
    â†“
Prisma Client
    â†“
SQLiteæ•°æ®åº“
    â†“
è¿”å›æˆåŠŸ/é”™è¯¯
```

### 3. AIæ–‡æ¡£åˆ†ææµç¨‹
```
ç”¨æˆ·è¾“å…¥æ–‡æ¡£æ–‡æœ¬
    â†“
AIPanelç»„ä»¶
    â†“
POST /api/ai/analyze-document
    â†“
services/ai/document-analyzer.ts
    â†“
Anthropic Claude API
    â†“
è§£æJSONå“åº”
    â†“
è¿”å›æå–çš„æ•°æ®
    â†“
è‡ªåŠ¨å¡«å……è¡¨å•
```

### 4. å®¢æˆ·ç«¯åŠ è½½æµç¨‹
```
é¡µé¢åŠ è½½
    â†“
ClientSidebarç»„ä»¶
    â†“
GET /api/clients
    â†“
PrismaæŸ¥è¯¢ (åŒ…å«mortgages)
    â†“
è¿”å›å®¢æˆ·ç«¯åˆ—è¡¨
    â†“
æ˜¾ç¤ºåœ¨ä¾§è¾¹æ 
    â†“
ç”¨æˆ·é€‰æ‹©å®¢æˆ·ç«¯
    â†“
åŠ è½½å†å²æŠµæŠ¼è´·æ¬¾æ•°æ®
    â†“
è‡ªåŠ¨å¡«å……å¹¶è®¡ç®—
```

---

## ğŸ—ï¸ æ¶æ„æ¨¡å¼

### 1. **ç»„ä»¶æ¶æ„**
- **Server Components**: é»˜è®¤ï¼ˆ`layout.tsx`ï¼‰
- **Client Components**: éœ€è¦äº¤äº’çš„ç»„ä»¶ï¼ˆ`'use client'`ï¼‰
- **ç»„ä»¶åˆ†ç¦»**: è¡¨å•ã€ä»ªè¡¨æ¿ã€å›¾è¡¨åˆ†ç¦»

### 2. **æ•°æ®è·å–æ¨¡å¼**
- **Server Actions**: æ•°æ®åº“å†™å…¥æ“ä½œ
- **API Routes**: RESTful APIç«¯ç‚¹
- **å®¢æˆ·ç«¯è·å–**: Fetch APIç”¨äºè¯»å–æ“ä½œ

### 3. **çŠ¶æ€ç®¡ç†**
- **æœ¬åœ°çŠ¶æ€**: `useState`ï¼ˆç»„ä»¶çº§ï¼‰
- **æ— å…¨å±€çŠ¶æ€**: æœªä½¿ç”¨Redux/Zustand
- **æœåŠ¡å™¨çŠ¶æ€**: é€šè¿‡APIè·å–

### 4. **è®¡ç®—å¼•æ“è®¾è®¡**
- **çº¯å‡½æ•°**: æ‰€æœ‰è®¡ç®—å‡½æ•°æ— å‰¯ä½œç”¨
- **å¯æµ‹è¯•æ€§**: æ˜“äºå•å…ƒæµ‹è¯•
- **ç±»å‹å®‰å…¨**: TypeScriptç¡®ä¿ç±»å‹æ­£ç¡®
- **ç²¾åº¦å¤„ç†**: é˜²æ­¢æµ®ç‚¹æ•°é”™è¯¯

### 5. **å®‰å…¨æ¨¡å¼**
- **APIå¯†é’¥**: ä»…æœåŠ¡å™¨ç«¯å­˜å‚¨
- **è¾“å…¥éªŒè¯**: APIè·¯ç”±å’ŒServer Actions
- **é”™è¯¯å¤„ç†**: å…¨é¢çš„try-catch
- **ç±»å‹æ£€æŸ¥**: TypeScriptç¼–è¯‘æ—¶æ£€æŸ¥

---

## ğŸ” å®‰å…¨è€ƒè™‘

### APIå¯†é’¥å®‰å…¨
- `ANTHROPIC_API_KEY` å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
- ä»…åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼ˆAPI Routesï¼‰
- æ°¸è¿œä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯

### è¾“å…¥éªŒè¯
- æ–‡æ¡£æ–‡æœ¬é•¿åº¦é™åˆ¶ï¼ˆ100,000å­—ç¬¦ï¼‰
- ç±»å‹æ£€æŸ¥ï¼ˆTypeScript + è¿è¡Œæ—¶éªŒè¯ï¼‰
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆPrismaå‚æ•°åŒ–æŸ¥è¯¢ï¼‰

### é”™è¯¯å¤„ç†
- æ‰€æœ‰APIè·¯ç”±éƒ½æœ‰é”™è¯¯å¤„ç†
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- æœåŠ¡å™¨ç«¯æ—¥å¿—è®°å½•

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. **Next.jsä¼˜åŒ–**
- Server Componentså‡å°‘JavaScriptåŒ…å¤§å°
- è‡ªåŠ¨ä»£ç åˆ†å‰²
- å›¾åƒä¼˜åŒ–ï¼ˆå¦‚æœä½¿ç”¨Next.js Imageï¼‰

### 2. **è®¡ç®—ä¼˜åŒ–**
- çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- è®¡ç®—ç»“æœç¼“å­˜ï¼ˆReactçŠ¶æ€ï¼‰
- æŒ‰éœ€è®¡ç®—ï¼ˆä»…åœ¨ç”¨æˆ·æäº¤æ—¶ï¼‰

### 3. **æ•°æ®åº“ä¼˜åŒ–**
- PrismaæŸ¥è¯¢ä¼˜åŒ–
- ç´¢å¼•ï¼ˆemail, clientIdï¼‰
- å…³ç³»é¢„åŠ è½½ï¼ˆ`include`ï¼‰

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æ•°å­¦å‡½æ•°æµ‹è¯•ï¼ˆJestï¼‰
- è¾¹ç•Œæƒ…å†µæµ‹è¯•
- ç²¾åº¦æµ‹è¯•

### é›†æˆæµ‹è¯•
- APIè·¯ç”±æµ‹è¯•
- æ•°æ®åº“æ“ä½œæµ‹è¯•
- Server Actionsæµ‹è¯•

### ç»„ä»¶æµ‹è¯•
- React Testing Library
- ç”¨æˆ·äº¤äº’æµ‹è¯•
- æ¸²æŸ“æµ‹è¯•

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
- Next.jså¼€å‘æœåŠ¡å™¨ (`npm run dev`)
- SQLiteæ•°æ®åº“
- æœ¬åœ°ç¯å¢ƒå˜é‡

### ç”Ÿäº§ç¯å¢ƒï¼ˆå»ºè®®ï¼‰
- **å¹³å°**: Vercelï¼ˆNext.jsä¼˜åŒ–ï¼‰
- **æ•°æ®åº“**: PostgreSQLï¼ˆæ›¿æ¢SQLiteï¼‰
- **ç¯å¢ƒå˜é‡**: Vercelç¯å¢ƒå˜é‡ç®¡ç†
- **CDN**: Vercelè‡ªåŠ¨CDN
- **ç›‘æ§**: å¯é›†æˆSentryç­‰

---

## ğŸ“ˆ æ‰©å±•æ€§è€ƒè™‘

### æ°´å¹³æ‰©å±•
- æ— çŠ¶æ€APIè·¯ç”±ï¼ˆå¯æ‰©å±•ï¼‰
- æ•°æ®åº“è¿æ¥æ± ï¼ˆPrismaï¼‰
- ç¼“å­˜å±‚ï¼ˆRedisï¼Œå¯é€‰ï¼‰

### åŠŸèƒ½æ‰©å±•
- å¤šç”¨æˆ·è®¤è¯ï¼ˆNextAuth.jsï¼‰
- è§’è‰²æƒé™ç³»ç»Ÿ
- PDFå¯¼å‡º
- ç”µå­é‚®ä»¶é€šçŸ¥
- å†å²è®°å½•è¿½è¸ª

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### 1. æœ¬åœ°å¼€å‘
```bash
npm install          # å®‰è£…ä¾èµ–
npx prisma migrate  # æ•°æ®åº“è¿ç§»
npm run dev         # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```

### 2. æ•°æ®åº“ç®¡ç†
```bash
npx prisma studio   # æ‰“å¼€æ•°æ®åº“GUI
npx prisma migrate  # åˆ›å»ºè¿ç§»
npx prisma generate # ç”ŸæˆPrismaå®¢æˆ·ç«¯
```

### 3. ä»£ç è´¨é‡
```bash
npm run lint        # ESLintæ£€æŸ¥
npm run build       # ç”Ÿäº§æ„å»º
npm test            # è¿è¡Œæµ‹è¯•
```

---

## ğŸ“š æŠ€æœ¯æ ˆæ€»ç»“è¡¨

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **æ¡†æ¶** | Next.js | 15.1.4 | å…¨æ ˆReactæ¡†æ¶ |
| **UIåº“** | React | 19.0.0 | ç”¨æˆ·ç•Œé¢ |
| **è¯­è¨€** | TypeScript | 5.7.2 | ç±»å‹å®‰å…¨ |
| **æ ·å¼** | Tailwind CSS | 3.4.17 | CSSæ¡†æ¶ |
| **æ•°æ®åº“** | Prisma | 6.2.0 | ORM |
| **æ•°æ®åº“** | SQLite | - | æ•°æ®åº“å¼•æ“ |
| **å›¾è¡¨** | Recharts | 2.15.0 | æ•°æ®å¯è§†åŒ– |
| **AI** | Anthropic SDK | 0.32.1 | Claude API |
| **æµ‹è¯•** | Jest | 29.7.0 | æµ‹è¯•æ¡†æ¶ |
| **Lint** | ESLint | 9.18.0 | ä»£ç æ£€æŸ¥ |

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. **ä¸ºä»€ä¹ˆä½¿ç”¨Next.js App Routerï¼Ÿ**
- Server Componentsæ€§èƒ½ä¼˜åŠ¿
- å†…ç½®APIè·¯ç”±
- æ›´å¥½çš„æ•°æ®è·å–æ¨¡å¼
- ç°ä»£åŒ–æ¶æ„

### 2. **ä¸ºä»€ä¹ˆä½¿ç”¨Prismaï¼Ÿ**
- ç±»å‹å®‰å…¨
- ä¼˜ç§€çš„å¼€å‘ä½“éªŒ
- æ•°æ®åº“æ— å…³ï¼ˆå¯åˆ‡æ¢ï¼‰
- è‡ªåŠ¨è¿ç§»

### 3. **ä¸ºä»€ä¹ˆä½¿ç”¨SQLiteï¼Ÿ**
- é›¶é…ç½®å¼€å‘
- å•æ–‡ä»¶æ•°æ®åº“
- æ˜“äºè¿ç§»åˆ°PostgreSQL
- å¿«é€Ÿè¿­ä»£

### 4. **ä¸ºä»€ä¹ˆä½¿ç”¨TypeScriptï¼Ÿ**
- è´¢åŠ¡è®¡ç®—éœ€è¦ç±»å‹å®‰å…¨
- æ›´å¥½çš„IDEæ”¯æŒ
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- ä»£ç è‡ªæ–‡æ¡£åŒ–

### 5. **ä¸ºä»€ä¹ˆä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ**
- æ˜“äºæµ‹è¯•
- æ— å‰¯ä½œç”¨
- å¯é¢„æµ‹æ€§
- æ˜“äºè°ƒè¯•

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ç°ä»£å…¨æ ˆWebåº”ç”¨çš„æœ€ä½³å®è·µï¼š

âœ… **ç±»å‹å®‰å…¨**: TypeScriptè´¯ç©¿æ•´ä¸ªåº”ç”¨  
âœ… **æ€§èƒ½ä¼˜åŒ–**: Server Componentså’Œä»£ç åˆ†å‰²  
âœ… **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ç›®å½•ç»“æ„å’Œç»„ä»¶åˆ†ç¦»  
âœ… **å®‰å…¨æ€§**: APIå¯†é’¥æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼Œè¾“å…¥éªŒè¯  
âœ… **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ åŠŸèƒ½  
âœ… **ç²¾åº¦å¤„ç†**: è´¢åŠ¡è®¡ç®—çš„æµ®ç‚¹æ•°é”™è¯¯é˜²æŠ¤  
âœ… **ç”¨æˆ·ä½“éªŒ**: å®æ—¶è®¡ç®—ï¼Œäº¤äº’å¼å¯è§†åŒ–  

è¯¥æ¶æ„ä¸ºç”Ÿäº§ç¯å¢ƒåšå¥½äº†å‡†å¤‡ï¼ŒåŒæ—¶ä¿æŒäº†å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚
