# AI-Powered Mortgage Portfolio Dashboard - Implementation Plan

## Project Overview
A full-stack system designed for mortgage professionals featuring AI-automated document processing, stress testing, and real-time decision-making analytics.

## Technical Stack
- **Framework**: Next.js 14+ (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Database**: PostgreSQL with Prisma ORM (SQLite fallback for portability)
- **Visualization**: Recharts
- **AI**: Anthropic Claude SDK (Claude API)

## Implementation Phases

### Phase 1: Project Initialization
- [x] Initialize Next.js project with TypeScript
- [ ] Configure Tailwind CSS
- [ ] Set up directory structure:
  - `/src/lib/math` - Mathematical calculation algorithms
  - `/src/services/ai` - AI logic layer
  - `/src/app/api` - API routes
  - `/src/components` - React components
  - `/src/types` - TypeScript type definitions

### Phase 2: Database Layer
- [ ] Install and configure Prisma
- [ ] Design schema:
  - **Client Model**: name, contact info, income, debts
  - **Mortgage Model**: principal, interest rate, amortization, payment frequency
- [ ] Generate Prisma Client
- [ ] Create database migrations
- [ ] Seed sample data for testing

### Phase 3: Core Math Engine
Implement financial calculations in `/src/lib/math`:

#### 3.1 Affordability Calculations
- [ ] GDS (Gross Debt Service) ratio calculator
  - Formula: (Housing costs / Gross income) × 100
  - Threshold: typically ≤ 32%
- [ ] TDS (Total Debt Service) ratio calculator
  - Formula: (Total debt payments / Gross income) × 100
  - Threshold: typically ≤ 40%

#### 3.2 Stress Testing
- [ ] Implement qualifying rate calculation (+2% above contract rate)
- [ ] Calculate maximum mortgage amount at stressed rate
- [ ] Compare affordability at contract vs stressed rates

#### 3.3 Sensitivity Analysis
- [ ] Generate payment scenarios across interest rate ranges
- [ ] Calculate amortization variations
- [ ] Prepare data structures optimized for Recharts visualization

### Phase 4: AI Document Processing Layer
- [ ] Create API route: `/app/api/ai/analyze-document/route.ts`
- [ ] Integrate Claude API SDK
- [ ] Design prompts for:
  - Document text extraction
  - Income verification data extraction
  - Debt obligation identification
  - Mortgage term prediction
- [ ] Implement error handling and validation
- [ ] Add rate limiting and security measures

### Phase 5: UI Dashboard
- [ ] Create responsive layout with Tailwind
- [ ] Build main dashboard page structure:
  - Client information panel
  - Mortgage details input form
  - Affordability metrics display (GDS/TDS)
  - Stress test results section
- [ ] Implement form validation
- [ ] Add loading states and error handling

### Phase 6: Data Visualization
- [ ] Install and configure Recharts
- [ ] Create visualization components:
  - Line chart: Payment amounts vs interest rates
  - Bar chart: GDS/TDS ratio comparison
  - Area chart: Amortization schedule
  - Gauge/Progress: Affordability indicators
- [ ] Implement interactive tooltips and legends
- [ ] Ensure responsive design for charts

### Phase 7: Integration & Testing
- [ ] Connect UI forms to database via API routes
- [ ] Integrate AI document processing with client data flow
- [ ] Connect math engine calculations to visualization components
- [ ] Write unit tests for math functions
- [ ] Write integration tests for API routes
- [ ] Perform end-to-end testing

### Phase 8: Polish & Deployment
- [ ] Add loading animations and transitions
- [ ] Implement error boundaries
- [ ] Optimize performance (memoization, lazy loading)
- [ ] Add documentation (README, API docs)
- [ ] Configure environment variables
- [ ] Prepare for deployment (Vercel/Railway)

## Automation Rules

### 1. Plan First
✓ This document serves as the master plan
- Review and update after each phase
- Document any deviations or learnings

### 2. Auto-Commit Strategy
After completing each major module, commit with Conventional Commits format:
- `feat(math): implement GDS/TDS ratio calculations`
- `feat(db): add Prisma schema for Client and Mortgage`
- `feat(ai): integrate Claude API for document processing`
- `feat(ui): create dashboard skeleton with Tailwind`
- `feat(viz): add Recharts sensitivity charts`
- `test: add unit tests for affordability calculations`

### 3. Self-Check Protocol
After each phase:
1. Run `npm run build` - ensure no build errors
2. Run `npm test` - ensure tests pass
3. Run `npm run lint` - ensure code quality
4. Manual smoke test in browser
5. Update this plan document with completion status

## Key Technical Decisions

### Database Choice
- **Primary**: PostgreSQL for production (robust, scalable)
- **Fallback**: SQLite for local development (zero config)
- Prisma provides seamless switching between both

### Math Engine Design
- Pure functions for testability
- TypeScript interfaces for type safety
- Separate concerns: calculation logic vs data formatting

### AI Integration Approach
- Server-side API route (secure API keys)
- Structured prompts with JSON response format
- Graceful degradation if AI unavailable

### UI Architecture
- Server Components by default (Next.js App Router)
- Client Components only when needed (interactivity, state)
- Progressive enhancement approach

## Success Criteria
- ✅ All build checks pass
- ✅ Core calculations accurate (validated against industry standards)
- ✅ AI document processing functional with sample documents
- ✅ Dashboard responsive on mobile, tablet, desktop
- ✅ Charts interactive and visually clear
- ✅ Error handling comprehensive

## Next Steps
Begin Phase 1: Check current project state and initialize required dependencies.
